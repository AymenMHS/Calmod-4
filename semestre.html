<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="img/logo.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=ADLaM+Display&family=Alegreya+Sans+SC:ital,wght@0,100;0,300;0,400;0,500;0,700;0,800;0,900;1,100;1,300;1,400;1,500;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <title>CALMOD 4</title>
</head>
<body>
    <img id="return" src="img/return.png">
    <img id="info" src="img/question.png">
    <div id="filter"></div>
    <div id="widjet">
        <div class="closewidjet">
            <img src="img/X.png" id="closing">
        </div>
        <h1>Felicitation !</h1>
        <p>Moyenne total : ...</p>
    </div>
    <div class="home">
        <div class="homelogo" style="margin-bottom: 50px;">
            <img src="img/logo.png">
            <h1>CALMOD 4</h1>
        </div>
        <div class="home-calcul">
            <div class="module-calcul">
                <div class="nom-module">
                    <h1>Compilation</h1>
                    <p>Coeff: 3</p>
                </div>
                <div class="inputs-module">
                    <div class="input-module">
                        <label>CC</label>
                        <input type="number" name="compilation_cc">
                    </div>
                    <div class="input-module">
                        <label>EF</label>
                        <input type="number" name="compilation_ef">
                    </div>
                </div>
                <div class="result">
                    <div class="input-result">
                        <h2>Moyenne module</h2>
                        <p></p>
                    </div>
                    <div class="input-result-credit">
                        <h2>Credit</h2>
                        <p></p>
                    </div>
                </div>
            </div>
            <div class="module-calcul">
                <div class="nom-module">
                    <h1>SE</h1>
                    <p>Coeff: 3</p>
                </div>
                <div class="inputs-module">
                    <div class="input-module">
                        <label>CC</label>
                        <input type="number" name="se_cc">
                    </div>
                    <div class="input-module">
                        <label>EF</label>
                        <input type="number" name="se_ef">
                    </div>
                </div>
                <div class="result">
                    <div class="input-result">
                        <h2>Moyenne module</h2>
                        <p></p>
                    </div>
                    <div class="input-result-credit">
                        <h2>Credit</h2>
                        <p></p>
                    </div>
                </div>
            </div>
            <div class="module-calcul">
                <div class="nom-module">
                    <h1>IHM</h1>
                    <p>Coeff: 3</p>
                </div>
                <div class="inputs-module">
                    <div class="input-module">
                        <label>CC</label>
                        <input type="number" name="ihm_cc">
                    </div>
                    <div class="input-module">
                        <label>EF</label>
                        <input type="number" name="ihm_ef">
                    </div>
                </div>
                <div class="result">
                    <div class="input-result">
                        <h2>Moyenne module</h2>
                        <p></p>
                    </div>
                    <div class="input-result-credit">
                        <h2>Credit</h2>
                        <p></p>
                    </div>
                </div>
            </div>
            <div class="module-calcul">
                <div class="nom-module">
                    <h1>Genie Logiciel</h1>
                    <p>Coeff: 2</p>
                </div>
                <div class="inputs-module">
                    <div class="input-module">
                        <label>CC</label>
                        <input type="number" name="gl_cc">
                    </div>
                    <div class="input-module">
                        <label>EF</label>
                        <input type="number" name="gl_ef">
                    </div>
                </div>
                <div class="result">
                    <div class="input-result">
                        <h2>Moyenne module</h2>
                        <p></p>
                    </div>
                    <div class="input-result-credit">
                        <h2>Credit</h2>
                        <p></p>
                    </div>
                </div>
            </div>
            <div class="module-calcul">
                <div class="nom-module">
                    <h1>Probabilité</h1>
                    <p>Coeff: 2</p>
                </div>
                <div class="inputs-module">
                    <div class="input-module">
                        <label>CC</label>
                        <input type="number" name="proba_cc">
                    </div>
                    <div class="input-module">
                        <label>EF</label>
                        <input type="number" name="proba_ef">
                    </div>
                </div>
                <div class="result">
                    <div class="input-result">
                        <h2>Moyenne module</h2>
                        <p></p>
                    </div>
                    <div class="input-result-credit">
                        <h2>Credit</h2>
                        <p></p>
                    </div>
                </div>
            </div>
            <div class="module-calcul">
                <div class="nom-module">
                    <h1>PL</h1>
                    <p>Coeff: 2</p>
                </div>
                <div class="inputs-module">
                    <div class="input-module">
                        <label>CC</label>
                        <input type="number" name="pl_cc">
                    </div>
                    <div class="input-module">
                        <label>EF</label>
                        <input type="number" name="pl_exam">
                    </div>
                </div>
                <div class="result">
                    <div class="input-result">
                        <h2>Moyenne module</h2>
                        <p></p>
                    </div>
                    <div class="input-result-credit">
                        <h2>Credit</h2>
                        <p></p>
                    </div>
                </div>
            </div>
            <div class="module-calcul">
                <div class="nom-module">
                    <h1>Economie numérique</h1>
                    <p>Coeff: 1</p>
                </div>
                <div class="inputs-module">
                    <div class="input-module">
                        <label>EF</label>
                        <input type="number" name="eco_ef">
                    </div>
                </div>
                <div class="result">
                    <div class="input-result">
                        <h2>Moyenne module</h2>
                        <p></p>
                    </div>
                    <div class="input-result-credit">
                        <h2>Credit</h2>
                        <p></p>
                    </div>
                </div>
            </div>
            <div class="btn-valide">
                <button id="calcultotal">Calculer</button>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const inputs = document.querySelectorAll("input[type='number']");

            // Charger les valeurs sauvegardées depuis localStorage
            inputs.forEach(input => {
                const savedValue = localStorage.getItem(input.name);
                if (savedValue !== null) {
                    input.value = savedValue;
                }
            });

            // Sauvegarder les valeurs dans localStorage à chaque modification
            inputs.forEach(input => {
                input.addEventListener("input", () => {
                    localStorage.setItem(input.name, input.value);
                });
            });
        });

        document.getElementById("calcultotal").addEventListener("click", () => {
            const modules = document.querySelectorAll('.module-calcul');
            const coefMap = {
                "Compilation": 3,
                "SE": 3,
                "IHM": 3,
                "Genie Logiciel": 2,
                "Probabilité": 2,
                "PL": 2,
                "Economie numérique": 1
            };

            let totalMoyenne = 0;
            let totalCoef = 0;

            for (const module of modules) {
                const nomModule = module.querySelector('.nom-module h1').textContent.trim();
                const coef = coefMap[nomModule];
                const moyenneEl = module.querySelector('.input-result p');

                // Vérifie si la moyenne pour ce module est calculée
                if (!moyenneEl || !moyenneEl.textContent || isNaN(parseFloat(moyenneEl.textContent))) {
                    document.getElementById("widjet").querySelector("h1").textContent = "Erreur";
                    document.getElementById("widjet").querySelector("p").textContent = "Veuillez remplir toutes les notes.";
                    document.getElementById("widjet").style.display = "flex";
                    document.getElementById("filter").style.display = "flex";
                    return;
                }

                const moyenne = parseFloat(moyenneEl.textContent);
                totalMoyenne += moyenne * coef;
                totalCoef += coef;
            }

            const moyenneTotale = totalMoyenne / totalCoef;

            const widjet = document.getElementById("widjet");
            widjet.style.display = "flex";
            document.getElementById("filter").style.display = "flex";

            const message = moyenneTotale >= 10 ? "Félicitations !" : "Dommage...";
            widjet.querySelector("h1").textContent = message;
            widjet.querySelector("p").textContent = `Moyenne totale : ${moyenneTotale.toFixed(2)}`;
        });
        document.getElementById("calcultotal").addEventListener("click", () => {
            document.getElementById("widjet").style.display="flex";
            document.getElementById("filter").style.display="flex";
        });
        document.getElementById("closing").addEventListener("click", () => {
            document.getElementById("widjet").style.display="none";
            document.getElementById("filter").style.display="none";
        });
        document.getElementById("filter").addEventListener("click", () => {
            document.getElementById("widjet").style.display="none";
            document.getElementById("filter").style.display="none";
        });
        document.getElementById("return").addEventListener("click", () => {
            localStorage.setItem("redirectedFromAbout", "true");
            window.location.href = "index.html";
        });
        document.getElementById("info").addEventListener("click", () => {
            window.location.href = "calcul.html";
        });

        document.querySelectorAll("input[type='number']").forEach(input => {
            input.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                if (value < 0) e.target.value = 0;
                if (value > 20) e.target.value = 20;
                calculerMoyenneEtCredit(e.target.closest('.module-calcul'));
            });
        });

        function calculerMoyenneEtCredit(module) {
            const nomModule = module.querySelector('.nom-module h1').textContent.trim();
            const inputs = module.querySelectorAll("input[type='number']");
            const moyenneEl = module.querySelector('.input-result p');
            const creditEl = module.querySelector('.input-result-credit p');

            let moyenne = 0;
            switch (nomModule) {
                case 'Compilation':
                case 'SE':
                case 'Genie Logiciel':
                case 'IHM':
                case 'PL':
                case 'Probabilité':
                    const ccIHM = parseFloat(inputs[0]?.value || 0);
                    const efIHM = parseFloat(inputs[1]?.value || 0);
                    moyenne = (0.4 * ccIHM) + (0.6 * efIHM);
                    break;
                case 'Economie numérique':
                    const efEco = parseFloat(inputs[0]?.value || 0);
                    moyenne = efEco;
                    break;
            }

            moyenne = moyenne.toFixed(2); // Arrondi à 2 décimales
            moyenneEl.textContent = moyenne;

            const credit = parseFloat(moyenne) >= 10 ? (
                nomModule === 'Economie numérique' ? 2 :
                ['Probabilité', 'PL'].includes(nomModule) ? 4 :
                5
            ) : 0;
            creditEl.textContent = credit;
        }

        // Initialiser les calculs au chargement de la page
        window.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.module-calcul').forEach(module => {
                calculerMoyenneEtCredit(module);
            });
        });


    </script>
</body>
</html>
